# Мини-Блог на FastAPI

Простой веб-блог с аутентификацией пользователей, статьями и комментариями.

## Содержание

- [Функциональность](#функциональность)
- [Установка](#установка)
- [Конфигурация](#конфигурация)
- [Использование](#использование)
- [API Endpoints](#api-endpoints)
- [Структура проекта](#структура-проекта)
- [База данных](#база-данных)
- [Разработка](#разработка)

## Функциональность

### Основные возможности
-  Регистрация и аутентификация пользователей
-  Создание, редактирование и удаление статей
-  Система комментариев к статьям
-  Теги для статей
-  Поиск и фильтрация статей
-  Пагинация
-  Профиль пользователя
-  Система лайков статей
-  Сортировка статей (новые, старые, по популярности)

### Безопасность
-  Хэширование паролей (SHA256)
-  JWT аутентификация
-  Валидация входных данных
-  HTTP-only cookies
-  Проверка прав доступа к статьям

## Установка

### 1. Клонирование и настройка окружения
```bash
# Клонировать репозиторий
git clone <repository-url>
cd mini_blog

# Создать виртуальное окружение
python -m venv venv

# Активировать виртуальное окружение
# Linux/Mac:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# Установить зависимости
pip install -r requirements.txt

# Создать файл .env на основе .env.example
cp .env.example .env
```

### 2. Настройка базы данных
```bash
# Приложение использует SQLite по умолчанию
# База данных создается автоматически при первом запуске
```

### 3. Запуск приложения
```bash
# Разработческий режим (с авто-перезагрузкой)
uvicorn app.main:app --reload

# Или используйте скрипт запуска
python run.py
```

### 4. Доступ к приложению
- Веб-интерфейс: http://localhost:8000
- Документация API (Swagger UI): http://localhost:8000/docs
- Альтернативная документация (ReDoc): http://localhost:8000/redoc

## Конфигурация

Создайте файл `.env` в корне проекта:

```env
# Секретный ключ для JWT токенов
SECRET_KEY=your-secret-key-change-in-production

# Настройки базы данных (SQLite по умолчанию)
DATABASE_URL=sqlite:///./blog.db

# Настройки JWT
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Настройки приложения
DEBUG=True
```

## Использование

### Для пользователей
1. **Регистрация**: Создайте аккаунт на странице `/register`
2. **Вход**: Авторизуйтесь на странице `/login`
3. **Создание статей**: Нажмите "Новая статья" в навигации
4. **Чтение статей**: Просматривайте статьи на главной странице или в разделе "Статьи"
5. **Комментирование**: Оставляйте комментарии под статьями
6. **Лайки**: Ставьте лайки понравившимся статьям
7. **Профиль**: Управляйте своими данными в разделе "Профиль"

### Особенности
- Только авторы могут редактировать и удалять свои статьи
- Сортировка статей: по дате (новые/старые) и по популярности (лайки)
- Поиск по заголовку и содержанию статей
- Фильтрация по тегам
- Пагинация для большого количества статей

## API Endpoints

### Пользовательские эндпоинты
```
GET    /                 - Главная страница
GET    /login           - Страница входа
GET    /register        - Страница регистрации
POST   /api/login       - Аутентификация
POST   /api/register    - Регистрация нового пользователя
GET    /api/logout      - Выход из системы
GET    /profile         - Профиль пользователя
POST   /api/profile/update - Обновление профиля
```

### Эндпоинты статей
```
GET    /articles                    - Список всех статей
GET    /articles?search=...         - Поиск статей
GET    /articles?tag=...            - Фильтрация по тегу
GET    /articles?sort=...           - Сортировка (newest/oldest/popular)
GET    /articles/{article_id}       - Детальная страница статьи
GET    /articles/{article_id}/edit  - Редактирование статьи (только автор)
POST   /articles/{article_id}/edit  - Сохранение изменений
POST   /api/articles/{article_id}/delete - Удаление статьи
POST   /api/articles                - Создание новой статьи
GET    /articles/new               - Форма создания статьи
```

### Эндпоинты лайков
```
POST   /api/articles/{article_id}/like      - Поставить/убрать лайк
GET    /api/articles/{article_id}/likes/count - Количество лайков
```

### Эндпоинты комментариев
```
POST   /api/articles/{article_id}/comments - Добавить комментарий
```

## Структура проекта

```
mini_blog/
├── app/
│   ├── __init__.py
│   ├── main.py              # Основное приложение FastAPI
│   ├── database.py          # Настройки базы данных
│   ├── models.py            # SQLAlchemy модели
│   ├── schemas.py           # Pydantic схемы
│   ├── static/              # Статические файлы (CSS, JS, изображения)
│   │   ├── css/
│   │   └── js/
│   └── templates/           # HTML шаблоны Jinja2
│       ├── base.html        # Базовый шаблон
│       ├── index.html       # Главная страница
│       ├── login.html       # Страница входа
│       ├── register.html    # Страница регистрации
│       ├── articles.html    # Список статей
│       ├── article_detail.html # Детальная страница статьи
│       ├── edit_article.html # Редактирование статьи
│       ├── create_article.html # Создание статьи
│       └── profile.html     # Профиль пользователя
├── .env.example            # Пример конфигурации
├── .env                   # Файл конфигурации (создается)
├── requirements.txt       # Зависимости Python
├── README.md             # Документация
└── run.py                # Скрипт запуска
```

## База данных

### Модели данных
- **User** - Пользователи системы
- **Article** - Статьи блога
- **Comment** - Комментарии к статьям
- **Tag** - Теги для статей
- **Like** - Лайки статей

### Связи
- Один пользователь → много статей
- Одна статья → много комментариев
- Одна статья → много тегов (многие-ко-многим)
- Один пользователь → много лайков (многие-ко-многим)

## Разработка

### Запуск в режиме разработки
```bash
# Активировать виртуальное окружение
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# Запустить сервер с авто-перезагрузкой
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### Тестирование
```bash
# Установить тестовые зависимости
pip install pytest httpx

# Запустить тесты
pytest tests/
```

### Добавление новых функций
1. Добавьте новую модель в `app/models.py`
2. Создайте схему в `app/schemas.py` (если нужно)
3. Добавьте эндпоинт в `app/main.py`
4. Создайте HTML шаблон в `app/templates/`
5. Добавьте статические файлы в `app/static/`

### Миграции базы данных
```python
# Модели создаются автоматически при запуске
# При изменении моделей перезапустите приложение
```

## Технологии

- **Backend**: FastAPI, SQLAlchemy, Pydantic
- **Frontend**: Jinja2, Bootstrap 5, JavaScript
- **База данных**: SQLite (легко переключается на PostgreSQL/MySQL)
- **Аутентификация**: JWT, HTTP-only cookies
- **Шаблоны**: HTML5, CSS3, Bootstrap Icons


